# 01_å·¥å…·å¼€å‘åŸºç¡€

## ğŸ¯ å­¦ä¹ ç›®æ ‡
- ç†è§£å·¥å…·æ¥å£å®šä¹‰
- æŒæ¡åˆ›å»ºå·¥å…·çš„å®Œæ•´æµç¨‹
- å­¦ä¼šå‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†

## ğŸ“‹ å·¥å…·æ¥å£å®šä¹‰

```typescript
interface Tool {
  name: string;           // å·¥å…·åç§°ï¼ˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼‰
  description: string;    // å·¥å…·è¯¦ç»†æè¿°
  groups: string[];       // æƒé™ç»„æ ‡ç­¾ï¼ˆç”¨äºRBACï¼‰
  inputSchema: any;       // è¾“å…¥å‚æ•°çš„JSON Schema
  execute: (args: any) => Promise<ToolResult>;  // æ‰§è¡Œå‡½æ•°
}

interface ToolResult {
  content: Array<{
    type: 'text' | 'image' | 'resource';
    text?: string;
    data?: string;
    mimeType?: string;
  }>;
  isError?: boolean;
  structuredContent?: Record<string, unknown>;
}
```

## ğŸš€ åˆ›å»ºå·¥å…·çš„å®Œæ•´æµç¨‹

### æ­¥éª¤1: åˆ›å»ºå·¥å…·æ–‡ä»¶

åœ¨ `src/tools/` ç›®å½•ä¸‹åˆ›å»ºæ–°æ–‡ä»¶ï¼š

```typescript
// src/tools/my-tool.ts
import type { Tool, ToolResult } from '../types';

/**
 * å·¥å…·æè¿°æ³¨é‡Š
 * @groups ['public', 'basic']  // æƒé™ç»„æ ‡ç­¾
 */
export const myTool: Tool = {
  name: 'my_tool',
  description: 'å·¥å…·çš„è¯¦ç»†æè¿°ï¼Œè¯´æ˜å·¥å…·çš„åŠŸèƒ½å’Œç”¨é€”',
  groups: ['public', 'basic'],  // åˆ†é…æƒé™ç»„
  inputSchema: {
    type: 'object',
    properties: {
      param1: {
        type: 'string',
        description: 'å‚æ•°1æè¿°'
      },
      param2: {
        type: 'number',
        description: 'å‚æ•°2æè¿°',
        minimum: 0,
        maximum: 100
      }
    },
    required: ['param1']  // å¿…éœ€å‚æ•°
  },
  execute: async (args): Promise<ToolResult> => {
    // 1. å‚æ•°éªŒè¯
    if (!args || typeof args.param1 !== 'string') {
      throw new Error('param1å¿…é¡»æ˜¯å­—ç¬¦ä¸²');
    }

    // 2. æ‰§è¡Œä¸šåŠ¡é€»è¾‘
    const result = `å¤„ç†ç»“æœ: ${args.param1}`;

    // 3. è¿”å›ç»“æœ
    return {
      content: [{
        type: 'text',
        text: result
      }]
    };
  }
};
```

### æ­¥éª¤2: æ³¨å†Œå·¥å…·

åœ¨ `src/index.ts` ä¸­æ³¨å†Œå·¥å…·ï¼š

```typescript
// src/index.ts
import { myTool } from './tools/my-tool.js';

// åœ¨ registerTools æ–¹æ³•ä¸­æ³¨å†Œ
this.basicToolSet.register(myTool);
```

### æ­¥éª¤3: ç¼–è¯‘æµ‹è¯•

```bash
# ç¼–è¯‘é¡¹ç›®
npm run build

# æµ‹è¯•å·¥å…·åˆ—è¡¨
echo '{"jsonrpc":"2.0","id":1,"method":"tools/list","params":{}}' | node build/index.js

# æµ‹è¯•å·¥å…·æ‰§è¡Œ
echo '{"jsonrpc":"2.0","id":2,"method":"tools/call","params":{"name":"my_tool","arguments":{"param1":"test"}}}' | node build/index.js
```

## ğŸ” å‚æ•°éªŒè¯è¯¦è§£

### åŸºç¡€éªŒè¯
```typescript
execute: async (args): Promise<ToolResult> => {
  // 1. æ£€æŸ¥å‚æ•°å­˜åœ¨
  if (!args) {
    throw new Error('ç¼ºå°‘å‚æ•°');
  }

  // 2. ç±»å‹éªŒè¯
  if (typeof args.message !== 'string') {
    throw new Error('messageå¿…é¡»æ˜¯å­—ç¬¦ä¸²');
  }

  // 3. èŒƒå›´éªŒè¯
  if (args.value < 0 || args.value > 100) {
    throw new Error('valueå¿…é¡»åœ¨0-100ä¹‹é—´');
  }

  // 4. å¿…éœ€å‚æ•°éªŒè¯
  const required = ['name', 'value'];
  for (const param of required) {
    if (!(param in args)) {
      throw new Error(`ç¼ºå°‘å¿…éœ€å‚æ•°: ${param}`);
    }
  }

  // ... æ‰§è¡Œé€»è¾‘
}
```

### JSON Schema éªŒè¯
```typescript
inputSchema: {
  type: 'object',
  properties: {
    // å­—ç¬¦ä¸²å‚æ•°
    name: {
      type: 'string',
      description: 'ç”¨æˆ·å§“å',
      minLength: 1,
      maxLength: 50
    },
    
    // æ•°å­—å‚æ•°
    age: {
      type: 'number',
      description: 'ç”¨æˆ·å¹´é¾„',
      minimum: 0,
      maximum: 150
    },
    
    // æšä¸¾å‚æ•°
    status: {
      type: 'string',
      description: 'çŠ¶æ€',
      enum: ['active', 'inactive', 'pending']
    },
    
    // æ•°ç»„å‚æ•°
    items: {
      type: 'array',
      description: 'é¡¹ç›®åˆ—è¡¨',
      items: {
        type: 'string'
      },
      minItems: 1
    },
    
    // å¯¹è±¡å‚æ•°
    config: {
      type: 'object',
      description: 'é…ç½®å¯¹è±¡',
      properties: {
        timeout: { type: 'number' },
        retries: { type: 'number' }
      }
    }
  },
  required: ['name']
}
```

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

### ä½¿ç”¨æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯
```typescript
execute: async (args): Promise<ToolResult> => {
  try {
    // ä¸šåŠ¡é€»è¾‘
    const result = await process(args);
    
    return {
      content: [{ type: 'text', text: result }]
    };
  } catch (error) {
    if (error instanceof ValidationError) {
      throw new Error(`å‚æ•°é”™è¯¯: ${error.message}`);
    }
    if (error instanceof DatabaseError) {
      throw new Error(`æ•°æ®åº“é”™è¯¯: ${error.message}`);
    }
    // å…¶ä»–é”™è¯¯
    throw new Error(`å¤„ç†å¤±è´¥: ${error.message}`);
  }
}
```

### è¿”å›ç»“æ„åŒ–é”™è¯¯
```typescript
execute: async (args): Promise<ToolResult> => {
  // éªŒè¯å¤±è´¥
  if (!args.file) {
    return {
      content: [{ 
        type: 'text', 
        text: 'é”™è¯¯: ç¼ºå°‘å¿…éœ€å‚æ•° file' 
      }],
      isError: true
    };
  }

  // ä¸šåŠ¡å¤±è´¥
  const result = await processFile(args.file);
  if (!result.success) {
    return {
      content: [{ 
        type: 'text', 
        text: `å¤„ç†å¤±è´¥: ${result.error}` 
      }],
      isError: true,
      structuredContent: {
        errorCode: result.errorCode,
        details: result.details
      }
    };
  }

  // æˆåŠŸ
  return {
    content: [{ 
      type: 'text', 
      text: `æˆåŠŸ: ${result.message}` 
    }],
    structuredContent: result.data
  };
}
```

## ğŸ“Š å·¥å…·åˆ†ç»„ç­–ç•¥

### å¸¸ç”¨åˆ†ç»„
| ç»„å | è¯´æ˜ | é€‚ç”¨è§’è‰² |
|------|------|----------|
| `public` | å…¬å…±å·¥å…·ï¼Œæ— éœ€ç‰¹æ®Šæƒé™ | user, analyst, admin |
| `basic` | åŸºç¡€å·¥å…· | user, analyst, admin |
| `advanced` | é«˜çº§å·¥å…· | analyst, admin |
| `sensitive` | æ•æ„Ÿæ“ä½œ | analyst, admin |
| `data-group` | æ•°æ®å¤„ç† | analyst, admin |
| `file-io` | æ–‡ä»¶æ“ä½œ | user, admin |
| `admin-only` | ç®¡ç†å‘˜ä¸“ç”¨ | admin |
| `token-management` | Tokenç®¡ç† | admin |

### åˆ†ç»„åŸåˆ™
1. **æœ€å°æƒé™åŸåˆ™**ï¼šåªåˆ†é…å¿…è¦çš„ç»„æ ‡ç­¾
2. **åŠŸèƒ½ç›¸å…³æ€§**ï¼šé€»è¾‘ç›¸å…³çš„å·¥å…·åˆ†é…ç›¸åŒç»„
3. **å®‰å…¨è€ƒè™‘**ï¼šæ•æ„Ÿæ“ä½œä½¿ç”¨ç‹¬ç«‹çš„ç»„

### ç¤ºä¾‹
```typescript
// ä½æƒé™å·¥å…·
export const echoTool: Tool = {
  groups: ['public', 'basic']
};

// ä¸­ç­‰æƒé™å·¥å…·
export const dataTool: Tool = {
  groups: ['data-group', 'sensitive']
};

// é«˜æƒé™å·¥å…·
export const adminTool: Tool = {
  groups: ['admin-only', 'sensitive']
};
```

## ğŸ§ª æµ‹è¯•å·¥å…·

### å•å…ƒæµ‹è¯•
```typescript
// test/tools/my-tool.test.js
import { myTool } from '../build/tools/my-tool.js';

async function testMyTool() {
  try {
    // æµ‹è¯•æ­£å¸¸æƒ…å†µ
    const result1 = await myTool.execute({ param1: 'test' });
    console.log('âœ“ æ­£å¸¸æµ‹è¯•é€šè¿‡:', result1);

    // æµ‹è¯•é”™è¯¯æƒ…å†µ
    try {
      await myTool.execute({});
      console.log('âœ— é”™è¯¯æµ‹è¯•å¤±è´¥');
    } catch (e) {
      console.log('âœ“ é”™è¯¯æµ‹è¯•é€šè¿‡:', e.message);
    }
  } catch (error) {
    console.error('æµ‹è¯•å¤±è´¥:', error);
  }
}

testMyTool();
```

### é›†æˆæµ‹è¯•
```bash
# æµ‹è¯•å·¥å…·åˆ—è¡¨
echo '{"jsonrpc":"2.0","id":1,"method":"tools/list","params":{}}' | node build/index.js

# æµ‹è¯•å·¥å…·æ‰§è¡Œ
echo '{"jsonrpc":"2.0","id":2,"method":"tools/call","params":{"name":"my_tool","arguments":{"param1":"test"}}}' | node build/index.js
```

## ğŸ¯ æœ€ä½³å®è·µæ€»ç»“

### 1. å·¥å…·è®¾è®¡åŸåˆ™
- âœ… **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªå·¥å…·åªåšä¸€ä»¶äº‹
- âœ… **å‚æ•°éªŒè¯**ï¼šä¸¥æ ¼éªŒè¯æ‰€æœ‰è¾“å…¥
- âœ… **æ¸…æ™°æè¿°**ï¼šå·¥å…·å’Œå‚æ•°éƒ½è¦æœ‰è¯¦ç»†æè¿°
- âœ… **é”™è¯¯å¤„ç†**ï¼šæä¾›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯
- âœ… **æƒé™æœ€å°åŒ–**ï¼šåªåˆ†é…å¿…è¦çš„ç»„æ ‡ç­¾

### 2. ä»£ç è´¨é‡
- âœ… **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨TypeScriptç±»å‹å®šä¹‰
- âœ… **æ–‡æ¡£æ³¨é‡Š**ï¼šæ·»åŠ æ¸…æ™°çš„JSDocæ³¨é‡Š
- âœ… **é”™è¯¯æ—¥å¿—**ï¼šè®°å½•å…³é”®æ“ä½œå’Œé”™è¯¯
- âœ… **æ€§èƒ½è€ƒè™‘**ï¼šé¿å…é˜»å¡æ“ä½œ

### 3. å®‰å…¨è€ƒè™‘
- âœ… **è¾“å…¥éªŒè¯**ï¼šé˜²æ­¢æ³¨å…¥æ”»å‡»
- âœ… **æƒé™æ£€æŸ¥**ï¼šç¡®ä¿ç”¨æˆ·æœ‰æƒæ‰§è¡Œ
- âœ… **èµ„æºé™åˆ¶**ï¼šé™åˆ¶æ–‡ä»¶å¤§å°ã€æ‰§è¡Œæ—¶é—´
- âœ… **é”™è¯¯éš”ç¦»**ï¼šå·¥å…·é”™è¯¯ä¸å½±å“æœåŠ¡å™¨

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **æƒé™æ§åˆ¶**ï¼š[02_æƒé™æ§åˆ¶è¯¦è§£.md](02_æƒé™æ§åˆ¶è¯¦è§£.md)
- **æ¡†æ¶æ¶æ„**ï¼š[03_æ¡†æ¶æ¶æ„æ ¸å¿ƒ.md](03_æ¡†æ¶æ¶æ„æ ¸å¿ƒ.md)
- **å¿«é€Ÿå¼€å§‹**ï¼š[../secondary-docs/QUICK_START.md](../secondary-docs/QUICK_START.md)

---

**ä¸‹ä¸€æ­¥**: å­¦ä¹  [02_æƒé™æ§åˆ¶è¯¦è§£.md](02_æƒé™æ§åˆ¶è¯¦è§£.md)