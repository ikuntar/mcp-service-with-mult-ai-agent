# ç®€åŒ–ç‰ˆæç¤ºè¯å·¥ç¨‹è¯´æ˜

## ğŸ¯ è®¾è®¡ç›®æ ‡

å°†æç¤ºè¯å·¥ç¨‹ç®€åŒ–ä¸º**ä¸‰ç§æ ¸å¿ƒç»„ä»¶**ï¼š

1. **ç³»ç»Ÿæç¤ºè¯ (System Prompt)** - å®šä¹‰AIçš„åŸºç¡€è§’è‰²å’Œè¡Œä¸º
2. **è¿½åŠ æç¤ºè¯ (Append Prompt)** - åœ¨å¯¹è¯è¿‡ç¨‹ä¸­è¿½åŠ çš„æŒ‡ä»¤
3. **æ‹¼æ¥æç¤ºè¯ (Concatenate Prompt)** - å¯æ’å…¥åˆ°ä»»æ„æç¤ºè¯å˜é‡ä½ç½®

**æ‰€æœ‰ç»„ä»¶éƒ½æ”¯æŒ**ï¼š
- **å›ºå®šæ ¼å¼**ï¼šç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²
- **æ¨¡æ¿æ ¼å¼**ï¼šä½¿ç”¨å˜é‡æ›¿æ¢

---

## ğŸ“¦ ä¸‰ç§æç¤ºè¯è¯¦è§£

### 1. ç³»ç»Ÿæç¤ºè¯ (System Prompt)

**ä½œç”¨**ï¼šå®šä¹‰AIçš„åŸºç¡€è§’è‰²ã€ä»»åŠ¡å’Œè¡Œä¸ºå‡†åˆ™

**å›ºå®šæ ¼å¼**ï¼š
```typescript
{
  id: 'my-system',
  name: 'æˆ‘çš„ç³»ç»Ÿ',
  format: 'fixed',
  content: 'ä½ æ˜¯ä¸€ä½åŠ©æ‰‹ã€‚è¯·ç®€æ´å›ç­”ã€‚'
}
```

**æ¨¡æ¿æ ¼å¼**ï¼š
```typescript
{
  id: 'my-system',
  name: 'æˆ‘çš„ç³»ç»Ÿ',
  format: 'template',
  template: 'ä½ æ˜¯ä¸€ä½{{role}}ä¸“å®¶ã€‚è¯·åˆ†æ{{domain}}æ•°æ®ã€‚',
  variables: [
    { name: 'role', type: 'string', required: true },
    { name: 'domain', type: 'string', required: false, default: 'æŠ€æœ¯' }
  ]
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- å®šä¹‰AIè§’è‰²ï¼ˆä¸“å®¶ã€åŠ©æ‰‹ã€åˆ†æå¸ˆç­‰ï¼‰
- è®¾å®šä»»åŠ¡ç›®æ ‡
- å»ºç«‹è¡Œä¸ºå‡†åˆ™

---

### 2. è¿½åŠ æç¤ºè¯ (Append Prompt)

**ä½œç”¨**ï¼šåœ¨å¯¹è¯è¿‡ç¨‹ä¸­è¿½åŠ é¢å¤–æŒ‡ä»¤ï¼Œç”¨äºå¼ºåŒ–ã€ä¿®æ­£æˆ–è¡¥å……

**å›ºå®šæ ¼å¼**ï¼š
```typescript
{
  id: 'my-append',
  name: 'æˆ‘çš„è¿½åŠ ',
  format: 'fixed',
  content: 'è¯·ä½¿ç”¨JSONæ ¼å¼è¿”å›ã€‚',
  position: 'after'  // 'before' | 'after' | 'replace'
}
```

**æ¨¡æ¿æ ¼å¼**ï¼š
```typescript
{
  id: 'my-append',
  name: 'æˆ‘çš„è¿½åŠ ',
  format: 'template',
  template: 'è¾“å‡ºæ ¼å¼ï¼š\n- æ‘˜è¦ï¼š{{summary}}\n- å»ºè®®ï¼š{{suggestions}}',
  variables: [
    { name: 'summary', type: 'string', required: true }
  ],
  position: 'after'
}
```

**ä½ç½®é€‰é¡¹**ï¼š
- `before`ï¼šåœ¨ç³»ç»Ÿæç¤ºè¯**ä¹‹å‰**è¿½åŠ 
- `after`ï¼šåœ¨ç³»ç»Ÿæç¤ºè¯**ä¹‹å**è¿½åŠ ï¼ˆé»˜è®¤ï¼‰
- `replace`ï¼š**æ›¿æ¢**æ•´ä¸ªç³»ç»Ÿæç¤ºè¯

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ ¼å¼è¦æ±‚ï¼ˆJSONã€Markdownç­‰ï¼‰
- è´¨é‡æ£€æŸ¥
- åˆ†æ­¥æŒ‡ä»¤
- è§’è‰²å¼ºåŒ–

---

### 3. æ‹¼æ¥æç¤ºè¯ (Concatenate Prompt)

**ä½œç”¨**ï¼šå¯ä»¥æ’å…¥åˆ°ä»»æ„æç¤ºè¯çš„å˜é‡ä½ç½®ï¼Œå®ç°åŠ¨æ€æ‹¼æ¥

**å›ºå®šæ ¼å¼**ï¼š
```typescript
{
  id: 'my-concat',
  name: 'æˆ‘çš„æ‹¼æ¥',
  format: 'fixed',
  content: 'é¢å¤–æ•°æ®ï¼šsales.csv',
  target: {
    promptId: 'system-prompt',    // ç›®æ ‡æç¤ºè¯ID
    variableName: 'extra_data'    // ç›®æ ‡å˜é‡å
  },
  mode: 'replace'  // 'prepend' | 'append' | 'replace'
}
```

**æ¨¡æ¿æ ¼å¼**ï¼š
```typescript
{
  id: 'my-concat',
  name: 'æˆ‘çš„æ‹¼æ¥',
  format: 'template',
  template: 'ç”¨æˆ·IDï¼š{{user_id}}ï¼Œæ—¶é—´ï¼š{{timestamp}}',
  variables: [
    { name: 'user_id', type: 'string', required: true },
    { name: 'timestamp', type: 'string', required: false, default: '2024' }
  ],
  target: {
    promptId: 'system-prompt',
    variableName: 'context'
  },
  mode: 'append'
}
```

**æ‹¼æ¥æ¨¡å¼**ï¼š
- `prepend`ï¼šåœ¨å˜é‡å‰æ‹¼æ¥
- `append`ï¼šåœ¨å˜é‡åæ‹¼æ¥
- `replace`ï¼šæ›¿æ¢å˜é‡å†…å®¹

**ä½¿ç”¨åœºæ™¯**ï¼š
- åŠ¨æ€æ³¨å…¥æ•°æ®
- ä¸Šä¸‹æ–‡å¢å¼º
- å˜é‡è¡¥å……
- æ¡ä»¶æ‹¼æ¥

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šåŸºç¡€ç»„åˆ

```typescript
import { PromptManager } from './src/core/ai-agent/prompt-engine';

const manager = new PromptManager();

// 1. ç³»ç»Ÿæç¤ºè¯
manager.registerSystemPrompt({
  id: 'qa-system',
  name: 'é—®ç­”ç³»ç»Ÿ',
  format: 'fixed',
  content: 'ä½ æ˜¯ä¸€ä½åŠ©æ‰‹ã€‚è¯·ç”¨ä¸­æ–‡å›ç­”ã€‚'
});

// 2. è¿½åŠ æç¤ºè¯
manager.registerAppendPrompt({
  id: 'qa-format',
  name: 'é—®ç­”æ ¼å¼',
  format: 'fixed',
  content: 'è¯·ç›´æ¥å›ç­”ï¼Œä¸è¦å¤šä½™è§£é‡Šã€‚',
  position: 'after'
});

// 3. ç»„åˆ
const result = manager.composePrompt('qa-system', ['qa-format'], []);
console.log(result.content);
// è¾“å‡ºï¼š
// ä½ æ˜¯ä¸€ä½åŠ©æ‰‹ã€‚è¯·ç”¨ä¸­æ–‡å›ç­”ã€‚
//
// è¯·ç›´æ¥å›ç­”ï¼Œä¸è¦å¤šä½™è§£é‡Šã€‚
```

### ç¤ºä¾‹2ï¼šä½¿ç”¨æ‹¼æ¥æç¤ºè¯

```typescript
// ç³»ç»Ÿæç¤ºè¯ï¼ˆå¸¦å˜é‡ï¼‰
manager.registerSystemPrompt({
  id: 'analysis-system',
  name: 'åˆ†æç³»ç»Ÿ',
  format: 'template',
  template: 'ä½ æ˜¯ä¸€ä½{{role}}ä¸“å®¶ã€‚\næ•°æ®ï¼š{{data}}\né—®é¢˜ï¼š{{question}}',
  variables: [
    { name: 'role', type: 'string', required: true },
    { name: 'data', type: 'string', required: true },
    { name: 'question', type: 'string', required: true }
  ]
});

// æ‹¼æ¥æç¤ºè¯ï¼ˆæ³¨å…¥é¢å¤–æ•°æ®ï¼‰
manager.registerConcatenatePrompt({
  id: 'data-concat',
  name: 'æ•°æ®æ‹¼æ¥',
  format: 'fixed',
  content: 'sales.csv',
  target: {
    promptId: 'analysis-system',
    variableName: 'data'
  },
  mode: 'replace'
});

// ç»„åˆ
const result = manager.composePrompt(
  'analysis-system',
  [],
  ['data-concat'],
  {
    role: 'æ•°æ®åˆ†æ',
    question: 'é”€å”®è¶‹åŠ¿'
  }
);
// ç»“æœï¼šä½ æ˜¯ä¸€ä½æ•°æ®åˆ†æä¸“å®¶ã€‚æ•°æ®ï¼šsales.csv\né—®é¢˜ï¼šé”€å”®è¶‹åŠ¿
```

### ç¤ºä¾‹3ï¼šå®Œæ•´å·¥ä½œæµ

```typescript
// ç³»ç»Ÿæç¤ºè¯
const systemId = manager.createAgentSystemPrompt('Pythonä¸“å®¶', ['ä»£ç ç”Ÿæˆ', 'è°ƒè¯•']);

// è¿½åŠ æç¤ºè¯
const formatId = manager.addAgentFormat('markdown');
const qualityId = manager.addAgentQualityCheck(['å‡†ç¡®æ€§', 'å¯è¯»æ€§']);

// æ‹¼æ¥æç¤ºè¯ï¼ˆæ³¨å…¥ä»»åŠ¡ï¼‰
manager.registerConcatenatePrompt({
  id: 'task-concat',
  name: 'ä»»åŠ¡æ³¨å…¥',
  format: 'fixed',
  content: 'ç¼–å†™ç”¨æˆ·ç™»å½•å‡½æ•°',
  target: {
    promptId: 'agent-task',
    variableName: 'task'
  },
  mode: 'replace'
});

// ç»„åˆ
const prompt = manager.composePrompt(
  'agent-task',
  [formatId, qualityId],
  ['task-concat']
);
```

---

## ğŸ­ å·¥å‚æ–¹æ³•

### ç³»ç»Ÿæç¤ºè¯å·¥å‚
```typescript
SystemPromptFactory.createFixed('id', 'åç§°', 'å†…å®¹');
SystemPromptFactory.createTemplate('id', 'åç§°', 'æ¨¡æ¿{{var}}', variables);
SystemPromptFactory.createRole('id', 'ä¸“å®¶', ['èƒ½åŠ›1', 'èƒ½åŠ›2']);
SystemPromptFactory.createTask('id', 'ä»»åŠ¡', ['è¦æ±‚1', 'è¦æ±‚2']);
SystemPromptFactory.createCodeGenerator('id', 'Python', 'clean');
SystemPromptFactory.createAnalyzer('id', 'é”€å”®æ•°æ®');
```

### è¿½åŠ æç¤ºè¯å·¥å‚
```typescript
AppendPromptFactory.createFixed('id', 'åç§°', 'å†…å®¹', 'after');
AppendPromptFactory.createFormat('id', 'JSONæ ¼å¼');
AppendPromptFactory.createExample('id', 'ç¤ºä¾‹å†…å®¹');
AppendPromptFactory.createConstraints('id', ['å‡†ç¡®', 'å®Œæ•´']);
AppendPromptFactory.createStepByStep('id', ['æ­¥éª¤1', 'æ­¥éª¤2']);
AppendPromptFactory.createOutputFormat('id', 'json');
AppendPromptFactory.createQualityCheck('id', ['å‡†ç¡®æ€§', 'å®Œæ•´æ€§']);
```

### æ‹¼æ¥æç¤ºè¯å·¥å‚
```typescript
ConcatenatePromptFactory.createFixed('id', 'åç§°', 'å†…å®¹', target, 'replace');
ConcatenatePromptFactory.createTemplate('id', 'åç§°', 'æ¨¡æ¿{{var}}', variables, target);
ConcatenatePromptFactory.createPrepend('id', 'åç§°', 'å†…å®¹', target);
ConcatenatePromptFactory.createAppend('id', 'åç§°', 'å†…å®¹', target);
ConcatenatePromptFactory.createReplace('id', 'åç§°', 'å†…å®¹', target);
ConcatenatePromptFactory.createVariableInjection('id', 'var', 'å€¼', target);
```

### ç»„åˆå·¥å‚
```typescript
PromptComposition.simpleQA('ä¸­æ–‡');
PromptComposition.codeGeneration('Python', 'ç”¨æˆ·ç™»å½•');
PromptComposition.dataAnalysis('é”€å”®');
PromptComposition.creativeWriting('ç§‘å¹»');
PromptComposition.advancedWithConcatenate('ä¸“å®¶', 'åˆ†ææ•°æ®', 'é¢å¤–ä¿¡æ¯');
```

---

## ğŸ¯ å¿«é€ŸAPI

```typescript
import { SimplePrompt } from './src/core/ai-agent/prompt-engine';

// ç³»ç»Ÿæç¤ºè¯
SimplePrompt.system('ä½ æ˜¯ä¸€ä½åŠ©æ‰‹ã€‚');

// è¿½åŠ æç¤ºè¯
SimplePrompt.append('è¯·ç®€æ´å›ç­”ã€‚', 'after');

// æ‹¼æ¥æç¤ºè¯
SimplePrompt.concatenate(
  'é¢å¤–æ•°æ®ï¼šsales.csv',
  'system-id',
  'data',
  'replace'
);

// ç»„åˆ
SimplePrompt.compose(
  'ä½ æ˜¯ä¸€ä½ä¸“å®¶ã€‚',
  ['è¯·æä¾›ä»£ç ã€‚', 'ä½¿ç”¨Pythonã€‚'],
  [
    {
      content: 'sales.csv',
      targetPromptId: 'system-id',
      targetVariableName: 'data'
    }
  ]
);
```

---

## ğŸ¨ ä¸‰ç§æç¤ºè¯çš„å…³ç³»

```
ç³»ç»Ÿæç¤ºè¯ (åŸºç¡€)
    â†“
è¿½åŠ æç¤ºè¯ (å¢å¼º)
    â†“
æ‹¼æ¥æç¤ºè¯ (åŠ¨æ€æ³¨å…¥)
    â†“
æœ€ç»ˆæç¤ºè¯
```

**ç¤ºä¾‹**ï¼š
```
ç³»ç»Ÿæç¤ºè¯: ä½ æ˜¯ä¸€ä½{{role}}ä¸“å®¶ã€‚æ•°æ®ï¼š{{data}}
è¿½åŠ æç¤ºè¯: è¯·ä½¿ç”¨JSONæ ¼å¼è¿”å›ã€‚
æ‹¼æ¥æç¤ºè¯: æ³¨å…¥ role=æ•°æ®åˆ†æ, data=sales.csv

æœ€ç»ˆç»“æœ:
ä½ æ˜¯ä¸€ä½æ•°æ®åˆ†æä¸“å®¶ã€‚æ•°æ®ï¼šsales.csv
è¯·ä½¿ç”¨JSONæ ¼å¼è¿”å›ã€‚
```

---

## âœ… æ ¸å¿ƒç‰¹æ€§

- **3ç§ç»„ä»¶**ï¼šç³»ç»Ÿ + è¿½åŠ  + æ‹¼æ¥
- **2ç§æ ¼å¼**ï¼šå›ºå®š + æ¨¡æ¿
- **3ç§ä½ç½®**ï¼šbefore/after/replaceï¼ˆè¿½åŠ ï¼‰
- **3ç§æ¨¡å¼**ï¼šprepend/append/replaceï¼ˆæ‹¼æ¥ï¼‰
- **å˜é‡æ”¯æŒ**ï¼šæ¨¡æ¿å˜é‡ + é»˜è®¤å€¼ + éªŒè¯
- **å·¥å‚æ–¹æ³•**ï¼šå¿«é€Ÿåˆ›å»º
- **å¿«é€ŸAPI**ï¼šä¸€è¡Œä»£ç 

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šç®€å•é—®ç­”
```typescript
ç³»ç»Ÿ: 'ä½ æ˜¯ä¸€ä½åŠ©æ‰‹ã€‚'
è¿½åŠ : 'è¯·ç®€æ´å›ç­”ã€‚'
ç»“æœ: ç®€å•é—®ç­”ç³»ç»Ÿ
```

### åœºæ™¯2ï¼šä»£ç ç”Ÿæˆ
```typescript
ç³»ç»Ÿ: 'ä½ æ˜¯ä¸€ä½{{language}}å¼€å‘è€…ã€‚ä»»åŠ¡ï¼š{{task}}'
è¿½åŠ : 'åˆ†æ­¥æŒ‡ä»¤ + æ ¼å¼è¦æ±‚'
æ‹¼æ¥: 'æ³¨å…¥ language=Python, task=ç™»å½•å‡½æ•°'
ç»“æœ: å®Œæ•´ä»£ç ç”Ÿæˆæç¤ºè¯
```

### åœºæ™¯3ï¼šæ•°æ®åˆ†æ
```typescript
ç³»ç»Ÿ: 'ä½ æ˜¯ä¸€ä½{{role}}ä¸“å®¶ã€‚æ•°æ®ï¼š{{data}}'
è¿½åŠ : 'è´¨é‡æ£€æŸ¥ + æ ¼å¼è¦æ±‚'
æ‹¼æ¥: 'æ³¨å…¥ role=é”€å”®åˆ†æå¸ˆ, data=sales.csv'
ç»“æœ: ä¸“ä¸šåˆ†ææç¤ºè¯
```

### åœºæ™¯4ï¼šåŠ¨æ€ä¸Šä¸‹æ–‡
```typescript
ç³»ç»Ÿ: 'ç”¨æˆ·ï¼š{{user}}\næ—¶é—´ï¼š{{time}}\nä»»åŠ¡ï¼š{{task}}'
è¿½åŠ : 'è§’è‰²å¼ºåŒ–'
æ‹¼æ¥: 'æ³¨å…¥ user=å¼ ä¸‰, time=2024, task=åˆ†ææ•°æ®'
ç»“æœ: å¸¦ä¸Šä¸‹æ–‡çš„æç¤ºè¯
```

---

## ğŸ“Š å¯¹æ¯”åŸç³»ç»Ÿ

| ç‰¹æ€§ | åŸç³»ç»Ÿ | ç®€åŒ–ç³»ç»Ÿ |
|------|--------|----------|
| ç»„ä»¶æ•°é‡ | 6ä¸ª | 3ä¸ª |
| æ ¸å¿ƒæ¦‚å¿µ | æ¨¡æ¿ã€æ¸²æŸ“å™¨ã€é“¾ã€è·¯ç”±å™¨ã€è¯„ä¼°å™¨ã€ä¼˜åŒ–å™¨ | ç³»ç»Ÿã€è¿½åŠ ã€æ‹¼æ¥ |
| å¤æ‚åº¦ | é«˜ | ä½ |
| å­¦ä¹ æ›²çº¿ | é™¡å³­ | å¹³ç¼“ |
| é€‚ç”¨åœºæ™¯ | å¤æ‚å·¥ä½œæµ | ç®€å•ä»»åŠ¡ + åŠ¨æ€æ³¨å…¥ |

---

## ğŸ‰ æ€»ç»“

**ä¸‰ç§æç¤ºè¯ï¼Œæ— é™å¯èƒ½**ï¼š

1. **ç³»ç»Ÿæç¤ºè¯**ï¼šå®šä¹‰åŸºç¡€è§’è‰²
2. **è¿½åŠ æç¤ºè¯**ï¼šå¢å¼ºå’Œä¿®æ­£
3. **æ‹¼æ¥æç¤ºè¯**ï¼šåŠ¨æ€æ³¨å…¥

**ä½¿ç”¨å£è¯€**ï¼š
```
ç³»ç»Ÿå®šè§’è‰²ï¼Œè¿½åŠ åŠ æŒ‡ä»¤
æ‹¼æ¥æ³¨å˜é‡ï¼Œç»„åˆå‡ºç»“æœ
å›ºå®šç›´æ¥ç”¨ï¼Œæ¨¡æ¿å¡«å˜é‡
```

**è®°ä½**ï¼š
- **ç³»ç»Ÿæç¤ºè¯** = åŸºç¡€æ¡†æ¶
- **è¿½åŠ æç¤ºè¯** = å¢å¼ºåŠŸèƒ½
- **æ‹¼æ¥æç¤ºè¯** = åŠ¨æ€æ•°æ®

**ä¸€å¥è¯**ï¼šç³»ç»Ÿå®šæ¡†æ¶ï¼Œè¿½åŠ å¼ºåŠŸèƒ½ï¼Œæ‹¼æ¥æ³¨æ•°æ®ï¼